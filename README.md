# MapSearch 使用说明

## 简介

MapSearch 是一个基于高德地图 Web 服务的 POI 检索与导出工具。支持按省/市筛选区域、关键字查询、分页抓取，并将结果以 CSV 导出。

## 运行环境

- Windows 10/11
- Python 3.10+
- 需要可用的高德地图 API Key（在界面中填写）

## 快速开始

1. 安装依赖（已提供 `pyproject.toml`）：
   - 推荐使用 uv/pip 等安装方式。
2. 运行应用：
   - 双击运行，或命令行：`python main.py`
3. 在顶部输入框填写高德 Web 服务 Key。
4. 点击“加载省/市”按钮：
   - 优先使用本地 `config.json` 中的省市缓存；
   - 如需更新，点击按钮将从远程加载并写入本地配置。
5. 在左侧省份列表中点击省份名称，右侧会展示该省的城市；勾选需要检索的城市。
6. 输入关键字，开始检索，结果会在右侧实时显示，并可实时导出到 CSV。

## 主要功能

- 城市选择
  - 省份列表支持三态复选框：未选中、部分选中、已选中。
  - 点击省份名称仅切换右侧城市展示范围，不改变勾选状态。
  - 右侧城市列表为当前省份的全部城市，可逐一勾选。
- 关键字检索
  - 按页抓取 POI，实时在右侧面板展示。
  - 可暂停/继续与停止查询。
- 导出
  - 实时导出：检索过程中将新到的数据追加写入 CSV。
  - 另存为导出：将已抓取的汇总结果导出为 CSV。

## 导出规则（CSV）

- 字段选择：导出仅包含在“字段设置”中勾选的字段。
- 空值处理：
  - 当字段值为 `[]`（字符串）或空列表 `[]` 时，导出为“空字符串”。
  - 当一整行所有选中字段均为空（None、空字符串、`[]` 字符串、空列表）时，该行将被跳过，不写入 CSV。
- 文件编码：UTF-8 with BOM（utf-8-sig）。
- 实时导出文件名：默认 `realtime_export.csv`，可在界面输入框中自定义路径。

## 本地配置与缓存

- 配置文件：`config.json`
  - 存储省份与城市层级数据、查询状态统计等。
  - 从远程加载后会写入配置，下次启动优先读取配置以加快加载速度。
- 手动重置：可在界面中“重置已查询状态”，清空城市的查询标记与统计。

## 常见问题

- 加载失败或速度慢
  - 检查 API Key 是否有效；
  - 程序已内置重试与限速，必要时可多试几次或稍后再试。
- 台湾省下城市未显示
  - 现版本已在远程为空时自动填充，请点击“加载省/市”重新加载；
  - 若仍未显示，请反馈日志信息。

## 目录结构（简要）

- `main.py`：应用主界面与逻辑（省市加载、检索、导出等）
- `config.json`：省市缓存与状态
- `README.md`：说明文档

## 版本与更新要点

- v1.2（当前）
  - 新增：直辖市按市级显示；台湾省缺失时自动填充。

## 反馈与支持

- 如遇问题，请提交复现步骤、关键字、所选城市以及日志截图，方便快速定位与修复。
